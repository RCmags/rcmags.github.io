---
layout: post
title: "Render the output of an ADNS-3080 sensor as a grayscale image"
---

While working on a library to decode the signal from an ADNS 3080 mouse sensor, I had to develop a system to visualize the image that the camera inside the sensor received.
This was critical as without being able to see the image made by the camera, it wasn't easy or perhaps even impossible to focus the lens attached next to the sensor in order to get the best possible image and therefore the best possible motion tracking.
While the sensor did have a particular output called the squall output, which was a measure of the quality of the surface being measured, to obtain displacements, wasn't entirely accurate and varied greatly depending on the surface being seen. Therefore, the output it would have depended on other variables besides the focus of the focus of the camera.
I chose to use Python to generate the image that from the data, as it is a very flexible language with many libraries that made it easy to convert serial data being transmitted via an Arduino to a graphical display seen on the computer screen.
Since the data from the camera came in as an array, which each position in the array representing a pixel of the image, necessary to decompose this array into two dimensions to then render them as an image based on the position and data at a particular array entry.
In Python, this was done by using the TK Interlibrary to generate a grid of boxes whose color could be changed. 
Each box within the grid could have a gray scale value assigned to it, such that it could range from being white to black and any gray color in between. This proportionality would take into account differing values received from the data of the sensor.
A drop-back of this system is that since the array is being decomposed into two sections, we have two nested four loops within which a series of TK Enter elements are being modified. Python is known to be very slow when dealing with four loops, so the refresh rate of this image system was very slow.
The Python script also worked in conjunction with an Arduino script, which outputed the readings of the sensor, and sent them via the serial port.
The Arduino program took the readings from the sensor and flattened them into an array. However, in particular positions within that array, it specified a special character, which indicated the end of that axis, at which point the additional information was the other axis of the image.
To some extent, the fact that the data from the sensor was being sent character by character via the serial port, in addition to the slow double four loop in the Python script, meant that the entire image rendering in both ends was very slow.
Despite this limitation, the system worked well enough in order to focus the lens of the sensor when looking at a fixed image in space.
This system, unfortunately, was not well suited to looking at the camera in real time because the refresh rate was so low. However, that use case was deemed unimportant as the only function of the sensor is to measure displacements and not to be used as a camera per se. The devices can be used for that purpose that serve and work far better.

---

This repo contains a python script and an arduino sketch to render the output of an ADNS3080 mouse sensor as a grayscale image. This is ideal for focusing the lens on the sensor as its obvious when an image is blurry. Doing so greatly improves the SQUAL value and the subsequent motion detection. 

The script was written in __python 3__ and requires the [pyserial library](https://pythonhosted.org/pyserial/pyserial.html#overview). The arduino sketch makes use of the [ADNS3080 library](https://github.com/RCmags/ADNS3080). Credit goes to [Lauszus](https://github.com/Lauszus/ADNS3080) for the inspiration. The script is largely based on his work.

Both files work in conjunction and must have the same __baud rate__ and __begin character__. This last value controls when the python script starts and stops receiving information from the arduino. 

A properly focused camera should generate these kinds of images:
![image](https://raw.githubusercontent.com/RCmags/ADNS3080_frame_capture/main/images/car.png)
![image](https://raw.githubusercontent.com/RCmags/ADNS3080_frame_capture/main/images/hand.png)
![image](https://raw.githubusercontent.com/RCmags/ADNS3080_frame_capture/main/images/ruler.png)

### Github Repo:
[ADNS3080_frame_capture](https://github.com/RCmags/ADNS3080_frame_capture)

